<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Trial Creation · Weber.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/highlightjs/default.css" rel="stylesheet" type="text/css"/><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Weber.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Introduction</a></li><li><span class="toctext">User guide</span><ul><li><a class="toctext" href="../start/">Getting Started</a></li><li class="current"><a class="toctext" href>Trial Creation</a><ul class="internal"><li><a class="toctext" href="#Timed-Moments-1">Timed Moments</a></li><li><a class="toctext" href="#Compound-Moments-1">Compound Moments</a></li><li><a class="toctext" href="#Watcher-Moments-1">Watcher Moments</a></li><li><a class="toctext" href="#Conditional-Moments-1">Conditional Moments</a></li><li class="toplevel"><a class="toctext" href="#Adding-Trials-1">Adding Trials</a></li></ul></li><li><a class="toctext" href="../stimulus/">Stimulus Generation</a></li><li><a class="toctext" href="../adaptive/">Adaptive Tracks</a></li><li><a class="toctext" href="../advanced/">Advanced Experiments</a></li><li><a class="toctext" href="../extend/">Extending Weber</a></li></ul></li><li><span class="toctext">Reference</span><ul><li><a class="toctext" href="../experiment/">Experiments</a></li><li><a class="toctext" href="../trials/">Trials</a></li><li><a class="toctext" href="../sound/">Sound</a></li><li><a class="toctext" href="../video/">Video</a></li><li><a class="toctext" href="../event/">Events</a></li><li><a class="toctext" href="../extend_ref/">Extensions</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>User guide</li><li><a href>Trial Creation</a></li></ul><a class="edit-page" href="https://github.com/haberdashPI/Weber.jl/tree/094bb7a81fb349c1297888576c20bdeaf16b63c9/docs/src/trial_guide.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Trial Creation</span><a class="fa fa-bars" href="#"></a></div></header><p>We&#39;ll look in detail at how to create trials of an experiment. For a broad overview of trial creation refer to <a href="../start/">Getting Started</a>. The two basic steps to creating a trial are (1) defining a set of moments and (2) add moments to a trial. </p><h1><a class="nav-anchor" id="Defining-Moments-1" href="#Defining-Moments-1">Defining Moments</a></h1><p>Trials are composed of moments. There are several types of moments: timed moments, compound moments, watcher moments, and conditional moments.</p><h2><a class="nav-anchor" id="Timed-Moments-1" href="#Timed-Moments-1">Timed Moments</a></h2><p>Timed moments are the simplest kind of moment. They are are normally created by calling <a href="../trials/#Weber.moment"><code>moment</code></a>.</p><pre><code class="language-julia">moment([delta_t],[fn],args...;keys...)</code></pre><p>A timed moment waits <code>delta_t</code> seconds after the onset of the previous moment, and then runs the specified function (<code>fn</code>), if any, passing it any <code>args</code> and <code>keys</code> provided. Below is an example of creating a timed moment.</p><pre><code class="language-julia">moment(0.5s,play,mysound)</code></pre><p>This moment plays <code>mysound</code> 0.5 seconds after the onset of the previous moment.</p><p>There are several other kinds of timed moments, other than those created by calling <a href="../trials/#Weber.moment"><code>moment</code></a>. Specifically, <a href="../trials/#Weber.timeout"><code>timeout</code></a> and <a href="../trials/#Weber.await_response"><code>await_response</code></a> wait for a particular event to occur (such as a key press) before they begin.</p><h3><a class="nav-anchor" id="Guidlines-for-low-latency-moments-1" href="#Guidlines-for-low-latency-moments-1">Guidlines for low-latency moments</a></h3><p>Weber aims to present moments at low latencies for accurate experiments.</p><p>To maintain low latency, as much of the experimental logic as possible should be precomputed, outside of trial moments, during <a href="../start/#setup_time-1">setup-time</a>. The following operations are definitely safe to perform during a moment:</p><ol><li><p>Calls to <a href="../sound/#Weber.play"><code>play</code></a> to present a sound</p></li><li><p>Calls to <a href="../video/#Base.Multimedia.display"><code>display</code></a> to present a visual.</p></li><li><p>Calls to <a href="../trials/#Weber.record"><code>record</code></a> to save something to a data file (usually after any calls to <a href="../sound/#Weber.play"><code>play</code></a> or <a href="../video/#Base.Multimedia.display"><code>display</code></a>)</p></li></ol><p>Note that Julia compiles functions on demand (known as just-in-time or JIT compilation), which can lead to very slow runtimes the first time a function runs.  To minimize JIT compilation during an experiment, any functions called directly by a moment are first precompiled.</p><div class="admonition warning"><div class="admonition-title">Keep Moments Short</div><div class="admonition-text"><p>Long running moments will lead to latency issues. Make sure all functions that run in a moment terminate relatively quickly.</p></div></div><div class="admonition warning"><div class="admonition-title">Sync visuals to the refresh rate.</div><div class="admonition-text"><p>Visuals synchronize to the screen refresh rate. You can  find more details about this in the documentation of <a href="../video/#Base.Multimedia.display"><code>display</code></a></p></div></div><h2><a class="nav-anchor" id="Compound-Moments-1" href="#Compound-Moments-1">Compound Moments</a></h2><p>You can create more complicated moments by concatenating simpler moments together using the <code>&gt;&gt;</code> operator or <code>moment(momoment1,moment2,...)</code>.</p><p>A concatenation of moments starts immediately, proceeding through each of the moments in order. This allows for a more complex relationship in inter-moment timing. For example, the following code will present two sounds, one at 100 ms, the other 200 ms after the start of the trial. It will also display &quot;Too Late!&quot; on the screen if no keyboard key is pressed 150 ms after the start of the trial. </p><pre><code class="language-julia">addtrial(moment(100ms,play,soundA) &gt;&gt; moment(100ms,play,soundB),
         timeout(() -&gt; display(&quot;Too Late!&quot;),iskeydown,150ms))</code></pre><p>This exact sequence of timing would not be possible withou using the <code>&gt;&gt;</code> operator because the timing of the <code>timeout</code> moment depends on user input, while we want soundB to be played at a reliable time.</p><h2><a class="nav-anchor" id="Watcher-Moments-1" href="#Watcher-Moments-1">Watcher Moments</a></h2><p>Watcher moments are used to respond to events. Often, watcher moments need not be directly used. Instead, the higher level <a href="../trials/#Weber.response"><code>response</code></a> method can be used.</p><p>As long as a watcher moment is active it occurs any time an event is triggered. A watcher moment becomes active at the start of the preceding moment, or at the start of a trial (if it&#39;s the first moment in a trial). This latter form is most common, since generally one wishes to listen to all events during a trial. A watcher moments is simply a function that takes one argument: the event to be processed.</p><p>If the watcher is the first moment in a trial, the convenient <code>do</code> block syntax is possible.</p><pre><code class="language-julia">message = visual(&quot;You hit spacebar!&quot;)
addtrial(moment2,moment3) do event
  if iskeydown(key&quot;:space:&quot;)
    display(message,duration=500ms)
    record()
  end
end</code></pre><p>In the above example, &quot;You hit spacebar!&quot; is displayed for 500 ms every time the spacebar is hit.</p><p>Refer to the documentation for <a href="../event/">Events</a> for full details on how to respond to events.</p><h2><a class="nav-anchor" id="Conditional-Moments-1" href="#Conditional-Moments-1">Conditional Moments</a></h2><p>Conditional moments are a more advanced technique for creating moments and aren&#39;t normally necessary. They run a function only when a certain condition is true (the <a href="../trials/#Weber.when"><code>when</code></a> moment) or repeat a function until a condition is false (the <a href="../trials/#Weber.looping"><code>looping</code></a> moment). They require a good understanding of the difference between <a href="../start/#setup_time-1">setup- and run-time</a>, <a href="http://docs.julialang.org/en/stable/manual/functions/#anonymous-functions">anonymous functions</a>, and <a href="http://docs.julialang.org/en/stable/manual/variables-and-scoping/">scoping rules</a> in julia.</p><h1><a class="nav-anchor" id="Adding-Trials-1" href="#Adding-Trials-1">Adding Trials</a></h1><p>Normally, to add moments to a trial you simply call <a href="../trials/#Weber.addtrial"><code>addtrial</code></a>. There is also <a href="../trials/#Weber.addpractice"><code>addpractice</code></a>, and <a href="../trials/#Weber.addbreak"><code>addbreak</code></a>. These functions are nearly identical to <a href="../trials/#Weber.addtrial"><code>addtrial</code></a> but differ in how they update the trial and offset counters, and what they automatically <a href="../trials/#Weber.record"><code>record</code></a> to a data file.</p><p>All of these functions take a series of iterable objects of moments. The moments of all arguments are added in sequence. For convience these iterables can be nested, allowing functions that return multiple moments themselves to be easily passed to <a href="../trials/#Weber.addtrial"><code>addtrial</code></a>.</p><footer><hr/><a class="previous" href="../start/"><span class="direction">Previous</span><span class="title">Getting Started</span></a><a class="next" href="../stimulus/"><span class="direction">Next</span><span class="title">Stimulus Generation</span></a></footer></article></body></html>
